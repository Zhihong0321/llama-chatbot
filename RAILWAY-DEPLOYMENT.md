# Railway Deployment Guide

Step-by-step guide to deploy the LlamaIndex RAG Frontend to Railway.

---

## Prerequisites

- GitHub account with repository access
- Railway account (sign up at https://railway.app)
- Backend API already deployed at: `https://eternalgy-rag-llamaindex-production.up.railway.app`

---

## Deployment Steps

### Step 1: Prepare Repository

1. Ensure all changes are committed:
```bash
git add .
git commit -m "Ready for production deployment"
git push origin main
```

2. Verify the repository structure:
```
/
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ dist/ (generated by build)
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â””â”€â”€ ...
â”œâ”€â”€ DEPLOYMENT-SUMMARY.md
â”œâ”€â”€ DEPLOYMENT-CHECKLIST.md
â””â”€â”€ README.md
```

### Step 2: Create Railway Project

1. Go to https://railway.app
2. Click "New Project"
3. Select "Deploy from GitHub repo"
4. Choose your repository
5. Railway will auto-detect the project

### Step 3: Configure Build Settings

In Railway project settings:

#### Build Configuration
```
Build Command: cd frontend && npm install && npm run build
```

#### Start Configuration
```
Start Command: cd frontend && npm run preview -- --host 0.0.0.0 --port $PORT
```

#### Root Directory
```
Root Directory: /
```

#### Output Directory
```
Output Directory: frontend/dist
```

### Step 4: Set Environment Variables

In Railway project â†’ Variables tab, add:

```env
VITE_API_BASE_URL=https://eternalgy-rag-llamaindex-production.up.railway.app
NODE_ENV=production
```

### Step 5: Deploy

1. Click "Deploy" in Railway dashboard
2. Wait for build to complete (should take ~2-3 minutes)
3. Railway will provide a public URL (e.g., `https://your-app.up.railway.app`)

---

## Alternative: Static Hosting

If you prefer static hosting instead of running the preview server:

### Option A: Use Railway Static Hosting

1. Build locally:
```bash
cd frontend
npm run build
```

2. Deploy the `dist` folder as a static site

### Option B: Use Nginx

Create a `Dockerfile` in the frontend directory:

```dockerfile
FROM nginx:alpine
COPY dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

Create `nginx.conf`:

```nginx
server {
    listen 80;
    server_name _;
    root /usr/share/nginx/html;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    # Enable gzip compression
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
}
```

Then in Railway:
- Build Command: `cd frontend && npm install && npm run build`
- Start Command: (leave empty, Docker will handle it)
- Dockerfile Path: `frontend/Dockerfile`

---

## Post-Deployment Verification

### 1. Check Deployment Status
- Verify build completed successfully in Railway logs
- Check for any error messages
- Confirm the app is running

### 2. Test the Application

Visit your Railway URL and verify:

- [ ] Homepage loads without errors
- [ ] Navigation works
- [ ] Dashboard displays correctly
- [ ] Can create a new agent
- [ ] Can create a new vault
- [ ] Can upload a document
- [ ] Can chat with an agent
- [ ] API calls are successful (check Network tab)
- [ ] No console errors (check Browser DevTools)

### 3. Test API Connectivity

Open browser console and run:
```javascript
fetch('https://eternalgy-rag-llamaindex-production.up.railway.app/agents')
  .then(r => r.json())
  .then(console.log)
```

Should return list of agents.

### 4. Test Core Features

1. **Agent Management**:
   - Create a new agent
   - Edit agent settings
   - Copy cURL command
   - Delete agent

2. **Vault Management**:
   - Create a new vault
   - Select vault
   - Delete vault

3. **Document Upload**:
   - Upload a PDF or text file
   - Watch progress bar
   - Verify ingestion completes

4. **Chat**:
   - Start a chat session
   - Send a message
   - Receive response
   - Verify message history

---

## Troubleshooting

### Build Fails

**Error**: `npm install` fails
- **Solution**: Check `package.json` is valid
- **Solution**: Verify Node.js version compatibility

**Error**: `npm run build` fails
- **Solution**: Check TypeScript errors
- **Solution**: Run `npm run build` locally first

### App Doesn't Load

**Error**: White screen or 404
- **Solution**: Check start command is correct
- **Solution**: Verify `dist` folder was created
- **Solution**: Check Railway logs for errors

### API Calls Fail

**Error**: CORS errors
- **Solution**: Verify backend CORS settings allow your Railway domain
- **Solution**: Check `VITE_API_BASE_URL` environment variable

**Error**: Network errors
- **Solution**: Verify backend API is running
- **Solution**: Test API directly: `curl https://eternalgy-rag-llamaindex-production.up.railway.app/agents`

### Environment Variables Not Working

**Error**: API calls go to wrong URL
- **Solution**: Rebuild after setting environment variables
- **Solution**: Verify variable name is exactly `VITE_API_BASE_URL`
- **Solution**: Check variable is set in Railway dashboard

---

## Monitoring

### Railway Dashboard
- Check deployment logs
- Monitor resource usage
- View application metrics

### Application Logs
```bash
# View logs in Railway dashboard
# Or use Railway CLI:
railway logs
```

### Health Checks
Create a simple health check endpoint or monitor:
- Response times
- Error rates
- API availability

---

## Rollback

If something goes wrong:

1. **Quick Rollback**:
   - Go to Railway dashboard
   - Click "Deployments"
   - Select previous working deployment
   - Click "Redeploy"

2. **Git Rollback**:
   ```bash
   git revert HEAD
   git push origin main
   ```
   Railway will auto-deploy the reverted version

---

## Custom Domain (Optional)

To use a custom domain:

1. Go to Railway project â†’ Settings â†’ Domains
2. Click "Add Domain"
3. Enter your domain (e.g., `app.yourdomain.com`)
4. Add the provided CNAME record to your DNS provider
5. Wait for DNS propagation (5-30 minutes)

---

## Performance Optimization

### Enable Caching
Railway automatically caches npm dependencies between builds.

### CDN (Optional)
For better global performance, consider:
- Cloudflare (free tier available)
- Railway's built-in CDN

### Monitoring
Set up monitoring with:
- Railway's built-in metrics
- External services (Sentry, LogRocket, etc.)

---

## Security

### Environment Variables
- Never commit `.env` files
- Use Railway's environment variable management
- Rotate sensitive keys regularly

### HTTPS
- Railway provides HTTPS by default
- Ensure all API calls use HTTPS

### CORS
- Verify backend CORS settings
- Only allow your Railway domain

---

## Cost Estimation

Railway pricing (as of 2025):
- **Hobby Plan**: $5/month (includes $5 credit)
- **Pro Plan**: $20/month (includes $20 credit)

Estimated usage for this app:
- **Build time**: ~2 minutes per deployment
- **Runtime**: Minimal (static hosting or lightweight preview server)
- **Bandwidth**: Depends on traffic

**Recommendation**: Start with Hobby plan, upgrade if needed.

---

## Support

- **Railway Docs**: https://docs.railway.app
- **Railway Discord**: https://discord.gg/railway
- **Project Issues**: Check GitHub repository issues

---

## Success! ðŸŽ‰

Once deployed, your application will be live at:
```
https://your-app-name.up.railway.app
```

Share this URL with your team and start using the LlamaIndex RAG Frontend!
